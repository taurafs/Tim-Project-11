<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Notedfly</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="assets/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="assets/vendors/font-awesome/css/font-awesome.min.css">

    <link rel="stylesheet" href="assets/vendors/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" href="assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="assets/css/style.css">7

    <link rel="shortcut icon" href="assets/images/favicon.png" />
  </head>
  <body>
      <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
        <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-start">
          <a class="navbar-brand brand-logo" href="index.html"><img src="assets/images/logo.png" alt="logo" style="width: 200px;" /></a>
          <a class="navbar-brand brand-logo-mini" href="index.html"><img src="assets/images/logo-mini.svg" alt="logo" /></a>
        </div>
        <div class="navbar-menu-wrapper d-flex align-items-stretch">
          <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
            <span class="mdi mdi-menu"></span>
          </button>
          <div class="search-field d-none d-md-block">
            <form class="d-flex align-items-center h-100" action="#">
              <div class="input-group">
                <div class="input-group-prepend bg-transparent">
                  <i class="input-group-text border-0 mdi mdi-magnify"></i>
                </div>
                <input type="text" class="form-control bg-transparent border-0" placeholder="Search projects">
              </div>
            </form>
          </div>
          <ul class="navbar-nav navbar-nav-right">
            <li class="nav-item nav-profile dropdown">
              <a class="nav-link dropdown-toggle" id="profileDropdown" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                <div class="nav-profile-img">
                  <img src="assets/images/faces/face1.jpg" alt="image">
                  <span class="availability-status online"></span>
                </div>
                <div class="nav-profile-text">
                  <p class="mb-1 text-black">David Greymaax</p>
                </div>
              </a>
              <div class="dropdown-menu navbar-dropdown" aria-labelledby="profileDropdown">
               
                <a class="dropdown-item" href="index.html">
                  <i class="mdi mdi-logout me-2 text-primary"></i> Signout </a>
              </div>
            </li>
            <li class="nav-item d-none d-lg-block full-screen-link">
              <a class="nav-link">
                <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
              </a>
            </li>
          
          <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
            <span class="mdi mdi-menu"></span>
          </button>
        </div>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_sidebar.html -->
        <nav class="sidebar sidebar-offcanvas" id="sidebar">
          <ul class="nav">
            
            <li class="nav-item">
              <a class="nav-link" href="dashboard.html">
                <span class="menu-title">Dashboard</span>
                <i class="mdi mdi-home menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="profile.html">
                <span class="menu-title">Profile</span>
                <i class="fa fa-user menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="history.html">
                <span class="menu-title">history</span>
                <i class="fa fa-history menu-icon"></i>
              </a>
            </li>
          </ul>
        </nav>
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
            <div class="page-header">
              <h1 class="page-title" style="font-size: 40px; color: #3B5355;" >
                Welcome Back, User !
              </h1>
            </div>
            <h5 class="page-title" style="color: #3B5355; margin-bottom: 20px;" >
              Let's Make Financial Matters Easier And Efficient For A More Productive Life With Us 
            </h5>
            <div class="mb-3" style="display: flex; justify-content: flex-end; gap: 10px;">
              <button class="manageIncome"> Manage Income
              </button>
              <button class="manageExpense"> Manage Expenses
              </button>
            </div>
            <div class="row">
              <div class="col-md-4 stretch-card grid-margin">
                <div class="card card-img-holder text-white" style="background-color: #3B5355;">
                  <div class="card-body">
                    <h4 class="font-weight-normal mb-3">Total Balance </h4>
                    <h2 id="totalBalance">Rp. 0</h2> <!-- Placeholder for total balance -->
                    <h6 id="totalBalancePercentage" class="card-text" style="background-color: green; width: 50px; padding: 5px; border-radius: 20px;">60%</h6> <!-- Placeholder for percentage -->
                  </div>
                </div>
              </div>
              <div class="col-md-4 stretch-card grid-margin">
                <div class="card card-img-holder text-white" style="background-color: #3B5355;">
                  <div class="card-body">
                    <h4 class="font-weight-normal mb-3">Income</h4>
                    <h2 id="income">Rp. 0</h2> <!-- Placeholder for income -->
                    <h6 id="incomePercentage" class="card-text" style="background-color: green; width: 50px; padding: 5px; border-radius: 20px;">60%</h6> <!-- Placeholder for income percentage -->
                  </div>
                </div>
              </div>
              <div class="col-md-4 stretch-card grid-margin">
                <div class="card card-img-holder text-white" style="background-color: #3B5355;">
                  <div class="card-body">
                    <h4 class="font-weight-normal mb-3">Ekspense</h4>
                    <h2 id="expense">Rp. 0</h2> <!-- Placeholder for expense -->
                    <h6 id="expensePercentage" class="card-text" style="background-color: red; width: 50px; padding: 5px; border-radius: 20px;">60%</h6> <!-- Placeholder for expense percentage -->
                  </div>
                </div>
              </div>
            </div>            
            <div class="row">
              <div class="col-md-7 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <div class="clearfix">
                      <h4 class="card-title float-start">Total Balance Overview</h4>
                      <div id="visit-sale-chart-legend" class="rounded-legend legend-horizontal legend-top-right float-end"></div>
                    </div>
                    <canvas id="areaChart" class="mt-4"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-md-5 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">Statistics</h4>
                    <select id="chart-options" class="form-select mb-5">
                      <option value="data1" style="color: #000;">Ekspense</option>
                      <option value="data2" style="color: #000; ">Income</option>
                    </select>
                    <div class="doughnutjs-wrapper d-flex justify-content-center">
                      <canvas id="traffic-chart"></canvas>
                    </div>
                    <div id="traffic-chart-legend" class="rounded-legend legend-vertical legend-bottom-left pt-4"></div>
                  </div>
                </div>
              </div>
              <div id="manageIncomeModal" class="modal-right">
                <div class="modal-content">
                  <span class="close mt-5">&times;</span>
                  <h3>Add Income</h3>
                  <form>
                    <label for="incomeAmount">Income Amount:</label>
                        <input type="number" id="incomeAmount" name="incomeAmount" placeholder="Must Enter Number" required>
                    <label for="incomeDate">Income Date:</label>        
                        <input type="date" id="incomeDate" name="incomeDate" required>
                        <br><br>
                    <button type="submit" class="saveIncome">Save</button>
                  </form>
                </div>
              </div>

              <div id="manageExpenseModal" class="modal-right">
                <div class="modal-content">
                  <span class="close mt-5">&times;</span>
                  <h3>Add Expense</h3>
                  <form>
                    <label for="expenseAmount">Expense Amount:</label>
                    <input type="number" id="expenseAmount" name="expenseAmount" placeholder="Must Enter Number" required>
              
                    <label for="expenseDate">Expense Date:</label>
                    <input type="date" id="expenseDate" name="expenseDate" required>
              
                    <label for="expenseCategory">Categories:</label>
                      <div id="expenseCategory" name="expenseCategory" required>
                        <div style="display: flex; align-items: center; margin-right: 10px;">
                          <input type="radio" name="expenseCategory" value="money transfer" class="expenseCategory" required> 
                          <span class="mb-3">Money Transfer</span>
                        </div>
                        <div style="display: flex; align-items: center; margin-right: 10px;">
                          <input type="radio" name="expenseCategory" value="rent" class="expenseCategory" required>
                          <span class="mb-3">Rent</span>
                        </div>
                        <div style="display: flex; align-items: center; margin-right: 10px;">
                          <input type="radio" name="expenseCategory" value="food g" class="expenseCategory" required>
                          <span class="mb-3">Food And Groceries</span>
                        </div>
                        <div style="display: flex; align-items: center; margin-right: 10px;">
                          <input type="radio" name="expenseCategory" value="other" class="expenseCategory" required>
                          <span class="mb-3">Other</span>
                        </div>
                      </div>
                      <br><br>
              
                    <button type="submit" class="saveExpense">Save</button>
                  </form>
                </div>
              </div>
          </div>
        </div>
      </div>
    </div>
    <script src="assets/vendors/js/vendor.bundle.base.js"></script>
    <script src="assets/vendors/chart.js/chart.umd.js"></script>
    <script src="assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <script src="assets/js/off-canvas.js"></script>
    <script src="assets/js/misc.js"></script>
    <script src="assets/js/settings.js"></script>
    <script src="assets/js/todolist.js"></script>
    <script src="assets/js/jquery.cookie.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/chart.js"></script>

  </body>
</html>

<script>
const userId = localStorage.getItem("user_id");
  // Get current month and year
const currentDate = new Date();
const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0'); // Get month (1-12)
const currentYear = currentDate.getFullYear(); // Get current year

// Prepare payload
const payload = {
  user_id: userId,
  bulan: currentMonth,
  tahun: currentYear,
};

// Fetch data from the API
async function fetchDashboardData() {
  try {
    const response = await fetch(`http://localhost:8000/api/dashboard?user_id=${payload.user_id}&bulan=${payload.bulan}&tahun=${payload.tahun}`, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer YOUR_ACCESS_TOKEN" // Replace with actual token if needed
      }
    });

    if (response.ok) {
      const data = await response.json();
      // Assuming the API returns a structure like { total_balance, income, expense, percentage }
      updateUI(data);
      console.log(data)
    } else {
      const error = await response.json();
      alert(`Failed to fetch data: ${error.message}`);
    }
  } catch (err) {
    alert(`An error occurred: ${err.message}`);
  }
}

// Update UI with the fetched data
function updateUI(data) {
  // Assuming the API response contains these values
  document.getElementById("totalBalance").textContent = `Rp. ${data.data.total_income - data.data.total_expense }`;
  document.getElementById("income").textContent = `Rp. ${data.data.total_income}`;
  document.getElementById("expense").textContent = `Rp. ${data.data.total_expense}`;

  // // Update percentages
  // document.getElementById("totalBalancePercentage").textContent = `${data.data.total_balance_percentage}%`;
  // document.getElementById("incomePercentage").textContent = `${data.data.income_percentage}%`;
  // document.getElementById("expensePercentage").textContent = `${data.data.expense_percentage}%`;

  // // Update colors based on percentage values
  // document.getElementById("totalBalancePercentage").style.backgroundColor = data.data.total_balance_percentage > 50 ? "green" : "red";
  // document.getElementById("incomePercentage").style.backgroundColor = data.data.income_percentage > 50 ? "green" : "red";
  // document.getElementById("expensePercentage").style.backgroundColor = data.data.expense_percentage > 50 ? "green" : "red";
}

// Call the function to fetch data when the page loads
fetchDashboardData();

  // JavaScript to handle the modal
  const modal = document.getElementById("manageIncomeModal");
  const manageIncomeButton = document.querySelector(".manageIncome");
  const closeButton = document.querySelector(".modal-right .close");
  const saveIncomeButton = document.querySelector(".saveIncome");

  manageIncomeButton.addEventListener("click", () => {
    modal.style.transform = "translateX(0)";
  });

  closeButton.addEventListener("click", () => {
    modal.style.transform = "translateX(100%)";
  });

  window.addEventListener("click", (event) => {
    if (event.target === modal) {
      modal.style.transform = "translateX(100%)";
    }
  });


  const expenseModal = document.getElementById("manageExpenseModal");
  const manageExpenseButton = document.querySelector(".manageExpense");
  const expenseCloseButton = expenseModal.querySelector(".close");
  const saveExpenseButton = expenseModal.querySelector(".saveExpense");

  manageExpenseButton.addEventListener("click", () => {
    expenseModal.style.transform = "translateX(0)";
  });

  expenseCloseButton.addEventListener("click", () => {
    expenseModal.style.transform = "translateX(100%)";
  });

  // Handle form submission
  saveIncomeButton.addEventListener("click", async (event) => {
    event.preventDefault(); // Prevent default form submission

    const incomeAmount = document.getElementById("incomeAmount").value;
    const incomeDate = document.getElementById("incomeDate").value;

    if (!incomeAmount || !incomeDate) {
      alert("Please fill in all required fields.");
      return;
    }

    // Data to send to the API
    const userId = localStorage.getItem("user_id");

// if (!userId) {
//   alert("User ID not found. Please login again.");
//   return;
// }

// Data to send to the API
const payload = {
  jumlah: incomeAmount,
  jenis: "Pemasukan",
  tanggal: incomeDate,
  user_id: userId, // Tambahkan user_id
};

    try {
      const response = await fetch("http://127.0.0.1:8000/api/transaksi", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer YOUR_ACCESS_TOKEN" // Replace with actual token if required
        },
        body: JSON.stringify(payload)
      });

      if (response.ok) {
        const result = await response.json();
        alert("Income added successfully!");
        modal.style.transform = "translateX(100%)";
        // Optionally reload data or update UI here
      } else {
        const error = await response.json();
        alert(`Failed to add income: ${error.message}`);
      }
    } catch (err) {
      alert(`An error occurred: ${err.message}`);
    }
  });

  saveExpenseButton.addEventListener("click", async (event) => {
  event.preventDefault();

  const expenseAmount = document.getElementById("expenseAmount").value;
  const expenseDate = document.getElementById("expenseDate").value;
  const expenseCategory = document.querySelector('input[name="expenseCategory"]:checked');

  if (!expenseAmount || !expenseDate || !expenseCategory) {
    alert("Please fill in all required fields.");
    return;
  }

  const userId = localStorage.getItem("user_id");

  if (!userId) {
    alert("User ID not found. Please login again.");
    return;
  }

  const payload = {
    jumlah: expenseAmount,
    jenis: "Pengeluaran", // Expense type
    tanggal: expenseDate,
    kategori: expenseCategory.value, // Add selected category
    user_id: userId,
  };

  try {
    const response = await fetch("http://127.0.0.1:8000/api/transaksi", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer YOUR_ACCESS_TOKEN", // Replace with actual token if required
      },
      body: JSON.stringify(payload),
    });

    if (response.ok) {
      const result = await response.json();
      alert("Expense added successfully!");
      expenseModal.style.transform = "translateX(100%)";
    } else {
      const error = await response.json();
      alert(`Failed to add expense: ${error.message}`);
    }
  } catch (err) {
    alert(`An error occurred: ${err.message}`);
  }
});
</script>

<style>
  #incomeDate {
    background-color: #3B5355; /* Light blue */
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 5px;
}

/* Customize the calendar button */
#incomeDate::-webkit-calendar-picker-indicator {
    background-color: #007bff; /* Blue */
    color: white;
    border-radius: 4px;
    padding: 5px;
}

/* Hover effect for better UX */
#incomeDate:hover {
    background-color: #e6f7ff; /* Slightly lighter blue */
}


  #incomeAmount {
    background-color: #3B5355; /* Light blue */
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 5px;
}

/* Customize the calendar button */
#incomeAmount::-webkit-calendar-picker-indicator {
    background-color: #007bff; /* Blue */
    color: white;
    border-radius: 4px;
    padding: 5px;
}

/* Hover effect for better UX */
#incomeAmount:hover {
    background-color: #e6f7ff; /* Slightly lighter blue */
}
  .form-select {
    width: 25%; 
    padding: 10px;
    margin-bottom: 10px;
    margin-left: auto; 
    border-radius: 200px;
    border: 1px solid #fff; 
    background-color: #3C5354; 
    color: black;
    font-size: 14px; 
}
.form-select option {
    color: #000; /* Text color for dropdown options */
    background-color: #3C5354; /* Optional: Background color of options */
}
  .doughnutjs-wrapper {
    height: 200px;
}

/* From Uiverse.io by Mike11jr */ 
.manageIncome {
 padding: 1.1em 2em;
 background: none;
 border: 2px solid #fff;
 font-size: 15px;
 color: #131313;
 cursor: pointer;
 position: relative;
 overflow: hidden;
 transition: all 0.3s;
 border-radius: 12px;
 background-color: #ecd448;
 font-weight: bolder;
 box-shadow: 0 2px 0 2px #000;
}

.manageIncome:before {
 content: "";
 position: absolute;
 width: 100px;
 height: 80%;
 background-color: #ff6700;
 top: 50%;
 transform: skewX(30deg) translate(-150%, -50%);
 transition: all 0.5s;
}

.manageIncome:hover {
 background-color: #4cc9f0;
 color: #fff;
 box-shadow: 0 2px 0 2px #0d3b66;
}

.manageIncome:hover::before {
 transform: skewX(30deg) translate(150%, -50%);
 transition-delay: 0.1s;
}

.manageIncome:active {
 transform: scale(0.9);
}


/* From Uiverse.io by Mike11jr */ 
.manageExpense {
 padding: 1.1em 2em;
 background: none;
 border: 2px solid #fff;
 font-size: 15px;
 color: #131313;
 cursor: pointer;
 position: relative;
 overflow: hidden;
 transition: all 0.3s;
 border-radius: 12px;
 background-color: #ecd448;
 font-weight: bolder;
 box-shadow: 0 2px 0 2px #000;
}

.manageExpense:before {
 content: "";
 position: absolute;
 width: 100px;
 height: 80%;
 background-color: #ff6700;
 top: 50%;
 transform: skewX(30deg) translate(-150%, -50%);
 transition: all 0.5s;
}

.manageExpense:hover {
 background-color: #4cc9f0;
 color: #fff;
 box-shadow: 0 2px 0 2px #0d3b66;
}

.manageExpense:hover::before {
 transform: skewX(30deg) translate(150%, -50%);
 transition-delay: 0.1s;
}

.manageExpense:active {
 transform: scale(0.9);
}


.saveIncome {
 padding: 1em 2em;
 background: none;
 border: 2px solid #fff;
 font-size: 15px;
 color: #131313;
 cursor: pointer;
 position: relative;
 overflow: hidden;
 transition: all 0.3s;
 border-radius: 12px;
 background-color: #ecd448;
 font-weight: bolder;
 box-shadow: 0 2px 0 2px #000;
}

.saveIncome:before {
 content: "";
 position: absolute;
 width: 100px;
 height: 80%;
 background-color: #ff6700;
 top: 50%;
 transform: skewX(30deg) translate(-150%, -50%);
 transition: all 0.5s;
}

.saveIncome:hover {
 background-color: #4cc9f0;
 color: #fff;
 box-shadow: 0 2px 0 2px #0d3b66;
}

.saveIncome:hover::before {
 transform: skewX(30deg) translate(150%, -50%);
 transition-delay: 0.1s;
}

.saveIncome:active {
 transform: scale(0.9);
}


.saveExpense {
 padding: 1em 2em;
 background: none;
 border: 2px solid #fff;
 font-size: 15px;
 color: #131313;
 cursor: pointer;
 position: relative;
 overflow: hidden;
 transition: all 0.3s;
 border-radius: 12px;
 background-color: #ecd448;
 font-weight: bolder;
 box-shadow: 0 2px 0 2px #000;
}

.saveExpense:before {
 content: "";
 position: absolute;
 width: 100px;
 height: 80%;
 background-color: #ff6700;
 top: 50%;
 transform: skewX(30deg) translate(-150%, -50%);
 transition: all 0.5s;
}

.saveExpense:hover {
 background-color: #4cc9f0;
 color: #fff;
 box-shadow: 0 2px 0 2px #0d3b66;
}

.saveExpense:hover::before {
 transform: skewX(30deg) translate(150%, -50%);
 transition-delay: 0.1s;
}

.saveExpense:active {
 transform: scale(0.9);
}

/* Modal styles for sliding in from the right */
.modal-right {
  display: block; /* Always incl  ude this for sliding effects */
  position: fixed;
  z-index: 1000;
  top: 0;
  right: 0;
  width: 30%; /* Adjust as needed */
  height: 100%;
  background-color: #fefefe;
  box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);
  overflow: auto;
  border-radius: 10px 0 0 10px;
  transform: translateX(100%); /* Start off-screen */
  transition: transform 0.3s ease-in-out;
}

.modal-content {
  padding: 20px;
  margin-top: 100px;
}

.modal-content h3 {
  margin-bottom: 20px;
  font-size: 24px;
}

.modal-content form {
  display: flex;
  flex-direction: column;
}

.modal-content form input {
  padding: 10px;
  margin-bottom: 20px;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.modal-content form button {
  align-self: flex-end;
}

.close {
  color: #aaa;
  font-size: 28px;
  font-weight: bold;
  position: absolute;
  right: 10px;
  top: 10px;
  cursor: pointer;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
.expenseCategory {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid #ccc;
    margin-right: 5px;
    cursor: pointer;
    transition: background-color 0.3s, border-color 0.3s;
  }

  /* Default color before clicked */
  .expenseCategory[value="money transfer"]:not(:checked) {
    background-color: #3b5355;
  }
  .expenseCategory[value="rent"]:not(:checked) {
    background-color: #57999F;
  }
  .expenseCategory[value="food g"]:not(:checked) {
    background-color: #1A2626;
  }
  .expenseCategory[value="other"]:not(:checked) {
    background-color: #D3D3D3;
  }

  /* Checked state color */
  .expenseCategory:checked {
    border-color: transparent;
  }
  .expenseCategory[value="money transfer"]:checked {
    background-color: #6a8d8c;
  }
  .expenseCategory[value="rent"]:checked {
    background-color: #82b7b0;
  }
  .expenseCategory[value="food g"]:checked {
    background-color: #3b4e4e;
  }
  .expenseCategory[value="other"]:checked {
    background-color: #e0e0e0;
  }
</style>